# 4.3.2 Asset Loading Strategy

**Project:** Bones on Ice - Web Edition v1.0
**Audience:** Frontend UI Developer, Graphics Engine Developer
**Purpose:** To define a phased asset loading strategy that minimizes initial load time and hides subsequent loading behind user interaction, creating a seamless experience.

---

## 1. Core Principles

*   **Load Only What Is Necessary:** Never load assets for a screen the user hasn't navigated to yet.
*   **Load in Parallel with User Interaction:** Use the time a user spends on one screen (e.g., Main Menu) to pre-load assets for the *next* screen in the background.
*   **Provide Clear Visual Feedback:** The user must always know if something is loading. A simple, consistent loading indicator is required.

---

## 2. The `AssetLoader` Module

This will be a central, promise-based module responsible for all asset loading. It will manage a cache to avoid re-downloading assets.

*   **API:**
    *   `AssetLoader.loadManifest(manifestName, onProgress)`
        *   `manifestName`: The key for the asset group to load (e.g., `'mainMenu'`).
        *   `onProgress`: A callback function that receives a value from 0.0 to 1.0, used to update a loading bar UI.
        *   **Returns:** A `Promise` that resolves when all assets in the manifest are loaded and ready in the cache.

*   **Asset Manifest Format (`assets.json`):**
    We will define asset groups in a manifest file. This keeps asset management clean and separate from game code.
```$
{
  "mainMenu": [
    { "name": "logo", "url": "/assets/images/logo.png", "type": "image" },
    { "name": "mainFont", "url": "/assets/fonts/main.woff2", "type": "font" },
    { "name": "ui_click", "url": "/assets/sfx/click.mp3", "type": "audio" }
  ],
  "teamSelect": [
    { "name": "team_icons", "url": "/assets/images/teams.json", "type": "spritesheet" },
    { "name": "select_sfx", "url": "/assets/sfx/select.mp3", "type": "audio" }
  ],
  "game_common": [
    { "name": "rink_bg", "url": "/assets/images/rink.jpg", "type": "image" },
    { "name": "dice_sprites", "url": "/assets/images/dice.json", "type": "spritesheet" }
  ],
  "game_team_svarog": [
    { "name": "vfx_svarog", "url": "/assets/vfx/svarog_spirit.json", "type": "spritesheet" }
  ]
}
```$

---

## 3. Phased Loading Strategy

This is the step-by-step loading sequence tied to the application's user flow.

### **Phase 0: Initial Page Load (The "Cold Start")**

*   **Action:** User first opens the game's URL.
*   **Assets to Load:** The absolute bare minimum.
    1.  The main application JavaScript bundle.
    2.  A single "Loading..." font or a logo to display during the next phase.
*   **User Experience:** Should be nearly instantaneous.

### **Phase 1: Pre-Menu Loading**

*   **Action:** Immediately after the initial JS bundle is loaded.
*   **Assets to Load:** Everything needed for the Main Menu to be fully interactive.
    *   **Manifest:** `mainMenu`
*   **User Experience:** A simple loading screen is displayed (e.g., a logo with a progress bar). The `onProgress` callback from the `AssetLoader` updates the progress bar. Once the promise resolves, the loading screen fades out and the `MainMenu` screen fades in.
*   **Estimated Duration:** 1-3 seconds.

### **Phase 2: Background Loading (On Main Menu)**

*   **Action:** As soon as the `MainMenu` is interactive, we **immediately and silently** start loading the assets for the next logical screen.
*   **Assets to Load:**
    *   **Manifest:** `teamSelect`
*   **User Experience:** This is invisible to the user. They are busy looking at the Main Menu options. By the time they click "New Game," the assets should already be in the cache, allowing for an instant transition.
*   **Implementation:** `AssetLoader.loadManifest('teamSelect')` is called, but the application does not `await` the result. The loader works in the background.

### **Phase 3: Background Loading (On Team Selection)**

*   **Action:** As soon as the `TeamSelect` screen is displayed, we start loading all assets required for the main game. This is our largest loading chunk.
*   **Assets to Load:**
    *   **Manifests:** `game_common` + `game_team_[selectedTeamA]` + `game_team_[selectedTeamB]`.
    *   **Contents of `game_common`:**
        *   Rink background texture and line sprites.
        *   Puck sprite.
        *   Generic player token sprites.
        *   Dice sprite sheet ("bony" dice).
        *   Common VFX (e.g., `actionBlocked`, `goalScored`).
        *   Common game sounds (puck pass, shot, etc.).
    *   **Contents of team-specific manifests:**
        *   The unique Team Spirit VFX sprite sheet (e.g., Svarog's anvil, Winds' vortex).
*   **User Experience:**
    1.  The user is busy selecting their teams. This process gives us valuable time to load in the background.
    2.  After the second player confirms their team, we check if the loading promise has resolved.
    3.  If **YES:** Instantly transition to the game.
    4.  If **NO:** Display the main loading screen again with the progress bar showing the *remaining* progress of this larger load. This ensures the user never sees a "frozen" screen.

---

## 4. Loading Screen UI Specification

*   **Task:** The UI Developer will create a reusable `LoadingScreen` component.
*   **Components:**
    *   A full-screen container that matches the app's background.
    *   The game's logo.
    *   A `ProgressBar` component.
        *   **Props:** It must accept a `progress` prop (a number from 0 to 1) to update its visual state.
        *   **Visuals:** A clean, horizontal bar that fills with the primary accent color.
*   **Behavior:** The `GameController` will be responsible for showing and hiding this screen and passing the progress value from the `AssetLoader` to the UI component.