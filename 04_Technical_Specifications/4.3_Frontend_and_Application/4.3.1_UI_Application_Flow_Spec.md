# 4.3.1 UI Application Flow Specification

**Project:** Bones on Ice - Web Edition v1.0
**Audience:** Frontend UI Developer (Vue.js / React or equivalent)
**Purpose:** To define the components, data flow, state management, and event handling for all application screens and modals.

---

## 1. Global Application State & Controller

A central `GameController` or state management store (like Pinia/Vuex or Redux) will manage the overall application state. The UI components will primarily **read** from this state and **emit events** to it to request changes. This enforces a one-way data flow.

*   **Global State Properties:**
```$
{
  "currentScreen": "MainMenu", // e.g., 'MainMenu', 'TeamSelect', 'Game', 'Stats', 'Options'
  "gameSettings": {
    "musicVolume": 0.5,
    "sfxVolume": 0.8
  },
  "playerStats": {} // Populated by LocalStorageManager
}
```$

*   **Key Controller Methods (Event Handlers):**
    *   `handleNavigate(screenName)`: Changes the `currentScreen`.
    *   `handleStartGame(teamA_Id, teamB_Id)`: Initializes the `GameEngine`, provides it with the chosen teams, and navigates to the 'Game' screen.
    *   `handleEndGame()`: Destroys the `GameEngine` instance and navigates away from the 'Game' screen.
    *   `handleLoadStats()` / `handleSaveStats()`: Triggers methods on the `LocalStorageManager`.

---

## 2. Screen Specifications

### **2.1. Screen: Main Menu (`MainMenu.vue`)**

*   **Purpose:** The application's entry point and primary navigation hub.
*   **Components:**
    *   `GameLogo`: A static image/SVG component.
    *   `PrimaryButton` (x4): "New Game", "Player Stats", "Rules", "Options".
*   **State Management:** This component is stateless.
*   **Events Emitted:**
    *   `@click` on "New Game" button -> emits `navigateTo('TeamSelect')`.
    *   `@click` on "Player Stats" button -> emits `navigateTo('Stats')`.
    *   ...etc.

### **2.2. Screen: Team Selection (`TeamSelect.vue`)**

*   **Purpose:** A two-stage process for Player 1 and Player 2 to select their teams.
*   **Components:**
    *   `ScreenHeader`: A text component displaying the current prompt.
    *   `TeamIconGrid`: A grid of clickable `TeamIcon` components.
    *   `TeamDetailPanel`: A panel to display info about the hovered/selected team.
    *   `ConfirmButton`: A primary button.
*   **Local State:**
```$
{
  "currentSelectionStage": "PLAYER_1", // or 'PLAYER_2'
  "hoveredTeamId": null,
  "player1_Selection": null,
  "player2_Selection": null
}
```$
*   **Events & Interactions:**
    1.  On component `mount`, set `currentSelectionStage` to 'PLAYER_1'.
    2.  On `@hover` of a `TeamIcon` -> Update `hoveredTeamId`. Data is fetched from a static `teams.json` config file.
    3.  On `@click` of `ConfirmButton`:
        *   If `currentSelectionStage` is 'PLAYER_1', store the selection and change stage to 'PLAYER_2'.
        *   If `currentSelectionStage` is 'PLAYER_2', store the selection and emit `startGame(p1_selection, p2_selection)`.

### **2.3. Screen: Main Game (`Game.vue`)**

*   **Purpose:** The primary screen where the game is played. This is a container for the Graphics Engine canvas and the UI overlays.
*   **Components:**
    *   `GraphicsCanvas`: The `<canvas>` element managed by the PixiJS Graphics Engine.
    *   `GameUI_Overlay`: A transparent overlay containing all the UI components (Roster Panels, Action Panel, Game Log, etc.).
    *   `PauseMenu_Modal`: A modal component that is hidden by default (`v-if="isPaused"`).
*   **State Management:** This component is the "broker." It initializes the `GameEngine` and the `GraphicsEngine`. It listens for events from the `GameEngine` and calls the appropriate rendering methods on the `GraphicsEngine`.
*   **Events & Interactions:**
    *   `onKeyDown('Escape')` -> Toggles the `isPaused` local state.
    *   The `GameUI_Overlay` components will emit user actions (e.g., `playerActionSelected`, `diceRollClicked`) which this screen will pass to the `GameEngine`.
    *   Listens for a `game:over` event from the `GameEngine`, at which point it will display the `GameOver_Modal`.

### **2.4. Screen: Player Statistics (`Stats.vue`)**

*   **Purpose:** To display persistent win/loss data.
*   **Components:**
    *   `ScreenHeader`: "Player Statistics".
    *   `StatsTable`: A table/list component.
    *   `BackButton`.
*   **State Management:**
    *   On component `mount` -> Emits `loadStats` to the global controller and receives the data as a prop.
    *   The component will need a computed property to calculate and display the win rate for each team.
*   **Events Emitted:**
    *   `@click` on `BackButton` -> emits `navigateTo('MainMenu')`.

---

## 3. Modal Specifications

### **3.1. Modal A: Pause Menu (`PauseMenu_Modal.vue`)**

*   **Purpose:** To pause the game and offer navigation options.
*   **Props:** None. It is a simple view component.
*   **Components:**
    *   A semi-transparent full-screen background overlay.
    *   A central panel with buttons: "Resume Game", "Restart Match", "Exit to Main Menu".
*   **Events Emitted:**
    *   `@resume`: Hides the modal.
    *   `@restart`: Emits `endGame()` then `startGame()` with the same teams.
    *   `@exit`: Emits `endGame()` then `navigateTo('MainMenu')`.

### **3.2. Modal B: Game Over (`GameOver_Modal.vue`)**

*   **Purpose:** To announce the winner and provide post-game options.
*   **Props:**
```$
{
  "winnerName": "Team Svarog",
  "finalScore": "5 - 3"
}
```$
*   **Components:**
    *   Similar structure to the Pause Menu modal.
    *   `HeaderText`: Displays `winnerName`.
    *   `FinalScoreText`: Displays `finalScore`.
    *   Buttons: "Rematch", "Return to Main Menu".
*   **Events Emitted:**
    *   `@rematch`: Emits `endGame()` then `startGame()` with the same teams.
    *   `@exit`: Emits `endGame()` then `navigateTo('MainMenu')`.